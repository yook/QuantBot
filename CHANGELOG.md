# Changelog

## v1.1.9 — 2025-11-24 (патч)

Кратко: патч-релиз с исправлениями по удалению проектов, поведению UI для typing, улучшениями в обработке эмбедингов и прогрессом пайплайна обучения/классификации.

Основные изменения (детально):

- **Классификатор:** теперь тренировка и разметка берут обучающие примеры из таблицы `typing_samples`, а не из `categories`. Это устраняет рассинхрон при миграции схемы БД и делает поведение более предсказуемым.
  - Файл: `worker/trainAndClassify.cjs`
  - Последствия: typing-воркер больше не прерывается при отсутствии записей в `categories` — он проверяет метки в `typing_samples`.

- **UI — вставка в поле классификации (typing):** исправлена логика вставки/слияния фраз из буфера в существующие строки. Переход от ошибок с proxy/ref к корректному объединению тегов.
  - Файл: `src/components/keywords/settings/TypingConfig.vue`
  - Поведение: при вставке нескольких фраз они добавляются к текущей строке вместо перезаписи.

- **Транзакционное удаление проекта:** удаление проекта теперь выполняется в транзакции, удаляются зависящие строки (`urls`, `keywords`, `typing_samples`, `categories`, `stop_words`, `embeddings_cache` и т.д.). В случае ошибки выполняется откат, и рендерер получает статус удаления.
  - Файл: `electron/ipc/projects.ts`
  - Поведение: UI только после подтверждённого удаления удаляет проект из списка; предотвращены «осиротевшие» строки в БД.

- **Батчинг эмбедингов и прогресс пайплайна:**
  - Получение эмбедингов теперь разбито на батчи с callback-ами прогресса — это даёт плавные обновления прогресса при больших объёмах.
  - Добавлена привязка этапов (получение эмбедингов → обучение → получение эмбедингов для ключевых слов → классификация) к промежуткам 0..100%, воркер сообщает строки вида `progress: N` в stdout.
  - Файлы: `worker/embeddingsClassifier.cjs`, `worker/trainAndClassify.cjs`
  - Эффект: прогресс-бар в UI теперь обновляется по ходу выполнения длинных задач.

- **Store/IPC:** при удалении проекта рендерер проверяет результат от IPC и только затем убирает проект лоокально.
  - Файл: `src/stores/project.ts`

---

Подробный список изменённых ключевых файлов доступен в коммите `HEAD`.
